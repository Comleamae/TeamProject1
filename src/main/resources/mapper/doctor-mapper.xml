<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="doctorMapper">
    <resultMap id="doctor" type="com.green.TeamProject1.doctor.DoctorVO">
        <id column="DOC_LINUM" property="docLinum"/>
        <result column="DOC_NAME" property="docName"/>
        <result column="DEPT_NUM" property="deptNum"/>
        <association property="recepVO" resultMap="patientMapper.recep"/>
        <association property="mediDeptVO" resultMap="mediDept"/>
        <collection property="patientVO" resultMap="patientMapper.patient"/>
    </resultMap>

    <!-- 의사에 연결할 진료과 정보 -->
    <resultMap id="mediDept" type="com.green.TeamProject1.doctor.MediDeptVO">
        <result column="DEPT_NUM" property="deptNum"/>
        <result column="DEPT_NAME" property="deptName"/>
    </resultMap>


    <!--의사 한명의 정보를 받아옴-->
    <select id="getOneDoc" resultMap="doctor">
        SELECT *
        FROM DOCTOR
        WHERE DOC_LINUM = #{docLinum}
    </select>

    <!--의사 전체 리스트를 받아옴-->
    <select id="getAllDoc" resultMap="doctor">
        SELECT *
        FROM DOCTOR
    </select>

    <!-- 진료과 정보 받아오기 -->
    <select id="getDeptList" resultMap="mediDept">
        SELECT *
        FROM MEDI_DEPT
        ORDER BY DEPT_NUM;
    </select>

    <!--선택한 진료과에 소속된 의사 목록 조회-->
    <select id="getDoctorList" resultMap="doctor">
        SELECT *
        FROM DOCTOR
        WHERE dept_NUM = #{deptNum}
    </select>

    <!-- 대기자 목록에서 선택한 환자 진료 정보 삽입 -->
    <insert id="insertTreatInfo">
        INSERT INTO info_treat (
            pat_num
          , disease
          , about_pat
          , tre_date
            , DOC_LINUM
        )
        VALUES (
            #{patNum}
          , #{disease}
          , #{aboutPat}
          , NOW()
            , 1
        );
    </insert>

</mapper>
